<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TCL Price Impact Calculator</title>
  <style>
    :root {
      --bg-light: #f8f9fa;
      --bg-dark: #1a1a1a;
      --text-light: #212529;
      --text-dark: #f1f1f1;
      --card-light: #ffffff;
      --card-dark: #2b2b2b;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 20px auto;
      padding: 0 20px;
      max-width: 900px;
      line-height: 1.6;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: all 0.3s ease;
    }

    [data-theme="dark"] {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }

    h2 {
      color: #0d6efd;
      margin-bottom: 8px;
    }

    .section {
      margin-bottom: 24px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-top: 4px;
      background-color: var(--card-light);
      border: 1px solid #ccc;
      border-radius: 8px;
      color: inherit;
    }

    [data-theme="dark"] input[type="text"] {
      background-color: var(--card-dark);
      border: 1px solid #444;
      color: #fff;
    }

    button {
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    #themeToggle {
      float: right;
      font-size: 14px;
      background-color: #444;
      color: white;
      margin-top: -30px;
      margin-bottom: 20px;
    }

    .row-group {
      display: flex;
      gap: 16px;
    }

    .row-group > div {
      flex: 1;
    }

    .result {
      margin-top: 20px;
      background: var(--card-light);
      border-left: 6px solid #28a745;
      padding: 16px;
      white-space: pre-wrap;
      font-size: 15px;
      border-radius: 8px;
    }

    [data-theme="dark"] .result {
      background: var(--card-dark);
    }

    .action-row{
      display:flex;
      gap:12px;
      align-items:center;
      margin-top:12px;
    }
    .btn-trade{
      display:inline-block;
      padding:10px 20px;
      border-radius:8px;
      text-decoration:none;
      background:#2ff6de;
      color:#090909;
      font-size:16px;
      font-weight:600;
    }
    .btn-trade:hover{ opacity:.9; }

    /* Live stats (read-only) */
    .stats-row{ display:flex; gap:16px; }
    .stat{
      flex:1; padding:10px 12px; border:1px solid #ccc; border-radius:10px;
      background:var(--card-light);
    }
    [data-theme="dark"] .stat{ background:var(--card-dark); border-color:#444; }
    .stat-top{ display:flex; align-items:center; justify-content:space-between; font-size:13px; color:#6b7280; }
    .stat-value{ font-size:18px; font-weight:700; margin-top:6px; }
    .chip-live{
      font-size:11px; padding:2px 8px; border-radius:999px; background:#10b9811a; color:#10b981;
      display:inline-flex; align-items:center; gap:6px;
    }
    .chip-live::before{ content:"üîí"; }

    /* ‚úÖ RESPONSIVE */
    @media (max-width: 768px) {
      body {
        margin: 20px 12px;
      }
      .row-group {
        flex-direction: column;
      }
      h2 {
        font-size: 20px;
      }
      input[type="text"],
      button {
        font-size: 15px;
      }
      #themeToggle {
        float: none;
        display: block;
        margin: 10px 0 20px auto;
      }
      .stats-row{ flex-direction:column; }
    }
  </style>
</head>
<body>
  <h2>üìä TCL Price Impact Calculator</h2>
  <button id="themeToggle" onclick="toggleTheme()">üåô Toggle Theme</button>

  <div class="section">
    <strong>üîπ Initial Pool (Listing)</strong><br />
    TCL: <span>4,000,000</span> | USDC ($): <span>25,000</span> | Initial Price: <strong>0.006 $</strong>
  </div>

  <div class="section">
    <strong>üî∏ Current Pool</strong><br />
    <span style="font-size: 13px; color: #0d6efd;">üîµ Data is fetched live from the MultiversX Blockchain (DexScreener)</span>
    <br /><br />
    <div class="stats-row">
      <div class="stat">
        <div class="stat-top"><span>TCL in pool</span><span class="chip-live">Live</span></div>
        <div id="curTCL" class="stat-value">‚Äî</div>
      </div>
      <div class="stat">
        <div class="stat-top"><span>USDC ($) in pool</span><span class="chip-live">Live</span></div>
        <div id="curUSDC" class="stat-value">‚Äî</div>
      </div>
      <div class="stat">
        <div class="stat-top"><span>Current Price (USDC/TCL)</span><span class="chip-live">Live</span></div>
        <div id="curPrice" class="stat-value">‚Äî</div>
      </div>
    </div>
  </div>

  <div class="section">
    <strong>üí∞ Simulate Transaction</strong><br />
    <div class="row-group">
      <div style="flex: 2;">
        <label id="inputLabel">Enter amount in <b>USDC ($)</b> to buy TCL:</label>
        <input type="text" id="amount" placeholder="ex: 100" onblur="formatInputField(this)" />
      </div>
      <div style="flex: 1; display: flex; align-items: flex-end;">
        <button onclick="switchMode()" id="switchBtn">üîÅ Switch to: Sell TCL</button>
      </div>
    </div>

    <div class="action-row">
      <button style="background-color:#28a745;" onclick="calculate()">Calculate Impact</button>
      <a class="btn-trade"
         href="https://xexchange.com/trade?firstToken=USDC-c76f1f&secondToken=TCL-fe459d"
         target="_blank" rel="noopener noreferrer">Trade Now ‚Üó</a>
    </div>

    <div class="result" id="resultBox"></div>
  </div>

  <script>
    let mode = 'buy';
    const DEX_API_URL = "https://api.dexscreener.io/latest/dex/pairs/multiversx/erd1qqqqqqqqqqqqqpgq6quepqlx66rmwst8uxl6p28jhcrnva982jpszqhxff";

    function formatNumber(n) {
      return Number(n).toLocaleString("en-US", { maximumFractionDigits: 2 });
    }
    function parseNumber(value) {
      return parseFloat((value || '').toString().replace(/,/g, '')) || 0;
    }
    function formatInputField(input) {
      let value = input.value.replace(/,/g, '');
      if (!isNaN(value) && value !== '') {
        input.value = formatNumber(value);
      }
    }
    function getText(id){ return (document.getElementById(id).textContent || '').trim(); }
    function setText(id, v){ document.getElementById(id).textContent = v; }

    function switchMode() {
      const inputLabel = document.getElementById("inputLabel");
      const switchBtn = document.getElementById("switchBtn");
      const input = document.getElementById("amount");
      mode = (mode === 'buy') ? 'sell' : 'buy';

      inputLabel.innerHTML = mode === 'buy'
        ? 'Enter amount in <b>USDC ($)</b> to buy TCL:'
        : 'Enter amount in <b>TCL</b> to sell for USDC ($):';

      switchBtn.innerHTML = mode === 'buy'
        ? 'üîÅ Switch to: Sell TCL'
        : 'üîÅ Switch to: Buy TCL';

      input.value = '';
      document.getElementById("resultBox").innerHTML = '';
    }

    function toggleTheme() {
      const currentTheme = document.body.getAttribute('data-theme') || 'light';
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      document.getElementById('themeToggle').innerText = newTheme === 'dark'
        ? 'üåû Toggle Theme'
        : 'üåô Toggle Theme';
    }

    function calculate() {
      const tcl = parseNumber(getText("curTCL"));
      const usdc = parseNumber(getText("curUSDC"));
      const curPrice = parseNumber(getText("curPrice"));
      const value = parseNumber(document.getElementById("amount").value);
      const resultBox = document.getElementById("resultBox");

      resultBox.innerHTML = "";
      const feePct = 0.01;
      const valueAfterFee = value * (1 - feePct);

      if (mode === 'buy' && value > 0) {
        const newUSDC = usdc + valueAfterFee;
        const newTCL = (tcl * usdc) / newUSDC;
        const boughtTCL = tcl - newTCL;
        const avgPrice = value / boughtTCL;
        const newPrice = newUSDC / newTCL;
        const priceImpact = (avgPrice - curPrice) / avgPrice * 100;
        const pctChange = ((newPrice - curPrice) / curPrice) * 100;

        resultBox.innerHTML =
          `‚úÖ Buy TCL with ${formatNumber(value)} USDC ($)\n` +
          `Estimated TCL received: ${formatNumber(boughtTCL)}\n` +
          `Average paid price: ${avgPrice.toFixed(6)} USDC ($)/TCL\n` +
          `üí• Price Impact: ${priceImpact.toFixed(2)}%\n` +
          `üîº Estimated Increase: ${pctChange.toFixed(2)}%\n\n` +
          `üí≤ Estimated TCL final price: ${newPrice.toFixed(6)} USDC ($)\n` +
          `üîÑ Estimated Pool After Transaction:\n` +
          `‚Ä¢ TCL in Pool: ${formatNumber(newTCL)}\n` +
          `‚Ä¢ USDC in Pool: ${formatNumber(newUSDC)}`;
      } else if (mode === 'sell' && value > 0) {
        const newTCL = tcl + valueAfterFee;
        const newUSDC = (usdc * tcl) / newTCL;
        const receivedUSDC = usdc - newUSDC;
        const avgPrice = receivedUSDC / value;
        const newPrice = newUSDC / newTCL;
        const priceImpact = ((curPrice - avgPrice) / curPrice) * 100;
        const pctChange = ((newPrice - curPrice) / curPrice) * 100;

        resultBox.innerHTML =
          `‚úÖ Sell ${formatNumber(value)} TCL\n` +
          `Estimated USDC ($) received: ${formatNumber(receivedUSDC)}\n` +
          `Average received price: ${avgPrice.toFixed(6)} USDC ($)/TCL\n` +
          `üí• Price Impact: ${priceImpact.toFixed(2)}%\n` +
          `üîª Estimated Decrease: ${pctChange.toFixed(2)}%\n\n` +
          `üí≤ Estimated TCL final price: ${newPrice.toFixed(6)} USDC ($)\n` +
          `üîÑ Estimated Pool After Transaction:\n` +
          `‚Ä¢ TCL in Pool: ${formatNumber(newTCL)}\n` +
          `‚Ä¢ USDC in Pool: ${formatNumber(newUSDC)}`;
      } else {
        resultBox.innerHTML = "‚ö†Ô∏è Please enter a valid amount.";
      }
    }

    async function fetchPoolData() {
      try {
        const res = await fetch(DEX_API_URL);
        const data = await res.json();
        const pool = data.pair;
        setText("curTCL", formatNumber(pool.liquidity.base));
        setText("curUSDC", formatNumber(pool.liquidity.quote));
        setText("curPrice", parseFloat(pool.priceUsd).toFixed(6));
      } catch (err) {
        console.error("‚ùå Failed to fetch pool data:", err);
      }
    }

    window.onload = () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.setAttribute('data-theme', savedTheme);
      document.getElementById('themeToggle').innerText =
        savedTheme === 'dark' ? 'üåû Toggle Theme' : 'üåô Toggle Theme';

      fetchPoolData();

      setInterval(() => {
        fetchPoolData();
        const hasValue = parseNumber(document.getElementById('amount').value) > 0;
        if (hasValue) calculate();
      }, 300000);
    };
  </script>

  <style>
    #dexscreener-embed{position:relative;width:100%;padding-bottom:125%;}
    @media(min-width:1400px){#dexscreener-embed{padding-bottom:65%;}}
    #dexscreener-embed iframe{position:absolute;width:100%;height:100%;top:0;left:0;border:0;}
  </style>
  <div id="dexscreener-embed">
    <iframe src="https://dexscreener.com/multiversx/erd1qqqqqqqqqqqqqpgq6quepqlx66rmwst8uxl6p28jhcrnva982jpszqhxff?embed=1&loadChartSettings=0&trades=0&tabs=0&info=0&chartLeftToolbar=0&chartDefaultOnMobile=1&chartTheme=dark&theme=dark&chartStyle=1&chartType=usd&interval=15"></iframe>
  </div>
</body>
</html>
