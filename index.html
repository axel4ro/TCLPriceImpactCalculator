
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TCL Price Impact Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px auto;
      max-width: 720px;
      line-height: 1.6;
      background-color: #f8f9fa;
      color: #212529;
    }
    h2 {
      color: #0d6efd;
    }
    .section {
      margin-bottom: 24px;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      margin-top: 4px;
    }
    button {
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      background: #ffffff;
      border-left: 6px solid #28a745;
      padding: 16px;
      white-space: pre-wrap;
      font-size: 15px;
    }
    .row-group {
      display: flex;
      gap: 16px;
    }
    .row-group > div {
      flex: 1;
    }
  </style>
</head>
<body>
  <h2>üìä TCL Price Impact Calculator</h2>

  <div class="section">
    <strong>üîπ Initial Pool (Listing)</strong><br>
    TCL: <span id="initialTCL">4,000,000</span> | USDC ($) : <span id="initialUSDC ($) ">25,000</span> | Initial Price: <strong>0.006</strong>
  </div>

  <div class="section">
    <strong>üî∏ Current Pool</strong><br>
    <span style="font-size: 13px; color: #0d6efd;">üîµ Data is fetched live from the MultiversX Blockchain (DexScreener)</span><br><br>
    <div class="row-group">
      <div>
        <label>TCL in pool</label>
        <input type="text" id="curTCL" value="12,440,888" readonly>
      </div>
      <div>
        <label>USDC ($)  in pool</label>
        <input type="text" id="curUSDC ($) " value="10,164.21" readonly>
      </div>
      <div>
        <label>Current Price (USDC ($) /TCL)</label>
        <input type="text" id="curPrice" value="0.000817" readonly>
      </div>
    </div>
  </div>

  <div class="section">
    <strong>üí∞ Simulate Transaction</strong><br>
    <div class="row-group">
      <div style="flex: 2;">
        <label id="inputLabel">Enter amount in <b>USDC ($)  ($)</b> to buy TCL:</label>
        <input type="text" id="amount" placeholder="ex: 100" onblur="formatInputField(this)">
      </div>
      <div style="flex: 1; display: flex; align-items: flex-end;">
        <button onclick="switchMode()" id="switchBtn">üîÅ Switch to: Sell TCL</button>
      </div>
    </div>
  </div>

  <button style="background-color: #28a745;" onclick="calculate()">Calculate Impact</button>

  <div class="result" id="resultBox"></div>

  <script>
    let mode = 'buy'; // Default mode

    function formatNumber(n) {
      return Number(n).toLocaleString("en-US", { maximumFractionDigits: 2 });
    }

    function formatInputField(input) {
      let value = input.value.replace(/,/g, '');
      if (!isNaN(value) && value !== '') {
        input.value = formatNumber(value);
      }
    }

    function parseNumber(value) {
      return parseFloat(value.replace(/,/g, '')) || 0;
    }

    function switchMode() {
      const inputLabel = document.getElementById("inputLabel");
      const switchBtn = document.getElementById("switchBtn");
      const input = document.getElementById("amount");

      if (mode === 'buy') {
        mode = 'sell';
        inputLabel.innerHTML = 'Enter amount in <b>TCL</b> to sell for USDC ($) :';
        switchBtn.innerHTML = 'üîÅ Switch to: Buy TCL';
      } else {
        mode = 'buy';
        inputLabel.innerHTML = 'Enter amount in <b>USDC ($)  ($)</b> to buy TCL:';
        switchBtn.innerHTML = 'üîÅ Switch to: Sell TCL';
      }

      input.value = '';
      document.getElementById("resultBox").innerHTML = '';
    }

    function calculate() {
      const tcl = parseNumber(document.getElementById("curTCL").value);
      const USDC ($)  = parseNumber(document.getElementById("curUSDC ($) ").value);
      const curPrice = parseNumber(document.getElementById("curPrice").value);
      const value = parseNumber(document.getElementById("amount").value);
      const resultBox = document.getElementById("resultBox");

      resultBox.innerHTML = "";

      if (mode === 'buy' && value > 0) {
        const newUSDC ($)  = USDC ($)  + value;
        const newTCL = (tcl * USDC ($) ) / newUSDC ($) ;
        const boughtTCL = tcl - newTCL;
        const avgPrice = value / boughtTCL;
        const newPrice = newUSDC ($)  / newTCL;
        const pctChange = ((newPrice - curPrice) / curPrice) * 100;

        resultBox.innerHTML =
          `‚úÖ Buy TCL with ${formatNumber(value)} USDC ($) 
` +
          `Estimated TCL received: ${formatNumber(boughtTCL)}
` +
          `Average paid price: ${avgPrice.toFixed(6)} USDC ($) 
` +
          `Estimated final price: ${newPrice.toFixed(6)} USDC ($) 
` +
          `üîº Estimated Increase: ${pctChange.toFixed(2)}%`;
      } else if (mode === 'sell' && value > 0) {
        const newTCL = tcl + value;
        const newUSDC ($)  = (USDC ($)  * tcl) / newTCL;
        const receivedUSDC ($)  = USDC ($)  - newUSDC ($) ;
        const avgPrice = receivedUSDC ($)  / value;
        const newPrice = newUSDC ($)  / newTCL;
        const pctChange = ((newPrice - curPrice) / curPrice) * 100;

        resultBox.innerHTML =
          `‚úÖ Sell ${formatNumber(value)} TCL
` +
          `Estimated USDC ($)  received: ${formatNumber(receivedUSDC ($) )}
` +
          `Average received price: ${avgPrice.toFixed(6)} USDC ($) 
` +
          `Estimated final price: ${newPrice.toFixed(6)} USDC ($) 
` +
          `üîª Estimated Decrease: ${pctChange.toFixed(2)}%`;
      } else {
        resultBox.innerHTML = "Please enter a valid amount.";
      }
    }
  </script>
</body>
</html>

