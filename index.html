<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TCL – xPortal Signature</title>
<style>
  :root { color-scheme: dark; }
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Ubuntu,Arial;background:#0b0f14;color:#e8f6f2}
  .card{max-width:720px;margin:48px auto;padding:28px 24px;background:#0f151c;border:1px solid #1f2a36;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.25)}
  h1{font-size:28px;margin:0 0 12px}
  .muted{color:#9fb3c8}
  .row{display:flex;align-items:center;gap:10px;margin:14px 0}
  .key{min-width:110px;color:#9fb3c8}
  .val{word-break:break-all;font-weight:600}
  .btn{appearance:none;border:1px solid #1fe4d0;background:#0b4741;color:#dffffa;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .btn.sec{background:#111826;border-color:#2b3947;color:#cfe6ff}
  .grid{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .note{margin-top:14px;color:#9fb3c8;font-size:14px}
</style>
<div class="card">
  <h1>TCL – xPortal Signature</h1>
  <p class="muted">După semnare în xPortal vei vedea mai jos <b>signature</b> și <b>address</b>. Apasă Copy și lipește în Discord la bot.</p>

  <div class="row"><div class="key">Status</div><div id="st" class="val">Waiting…</div></div>
  <div class="row"><div class="key">Message</div><div id="msg" class="val">–</div></div>
  <div class="row"><div class="key">Address</div><div id="addr" class="val">–</div><button class="btn sec" id="copyAddr">Copy</button></div>
  <div class="row"><div class="key">Signature</div><div id="sig" class="val">–</div><button class="btn sec" id="copySig">Copy</button></div>

  <div class="grid">
    <a id="openWeb" class="btn">Open xPortal again</a>
    <button id="copyDeep" class="btn sec">Copy deeplink</button>
    <button id="copyIntent" class="btn sec">Copy Android intent</button>
  </div>
  <p class="note">Dacă nu apare semnătura: redeschide linkul din mesajul Discord sau apasă “Open xPortal again”.</p>
</div>

<script>
(function () {
  const qs = new URLSearchParams(location.search);
  const message = qs.get("message") || "";
  const address = qs.get("address") || "";
  const signature = qs.get("signature") || "";
  const status = qs.get("status") || (signature ? "signed" : "waiting");

  const $ = id => document.getElementById(id);
  $("msg").textContent = message || "–";
  $("addr").textContent = address || "–";
  $("sig").textContent = signature || "–";
  $("st").textContent = status === "cancelled" ? "Cancelled" : (signature ? "Signed ✓" : "Waiting…");

  // link care deschide browser->wallet.multiversx.com->xPortal
  const callbackUrl = location.origin + location.pathname; // rămânem pe aceeași pagină
  const walletHook = "https://wallet.multiversx.com/hook/sign-message?" +
    new URLSearchParams({ message, callbackUrl }).toString();
  $("openWeb").href = walletHook;

  // deeplink direct pentru aplicație
  const q = new URLSearchParams({ message, callbackUrl });
  const deeplink = "xportal://wallet/sign-message?" + q.toString();
  const intent = `intent://wallet/sign-message?${q.toString()}#Intent;scheme=xportal;package=com.elrond.maiar.wallet;end`;

  async function copy(txt) {
    try { await navigator.clipboard.writeText(txt); } catch(e) {
      const ta=document.createElement("textarea"); ta.value=txt; document.body.appendChild(ta);
      ta.select(); document.execCommand("copy"); ta.remove();
    }
  }

  $("copyAddr").onclick = () => address ? copy(address) : null;
  $("copySig").onclick  = () => signature ? copy(signature) : null;
  $("copyDeep").onclick = () => copy(deeplink);
  $("copyIntent").onclick = () => copy(intent);
})();
</script>
